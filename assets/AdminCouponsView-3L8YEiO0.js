import{K as P,G as g,H as _,S as h,M as E,N as V,_ as y,A as B,a as e,t as i,c,C as A,w as p,v as m,O as D,T,o as r,x as U,m as N,g as I,F as v,z as S,e as f,r as C,D as H,d as j}from"./index-C3VS7dNT.js";import{f as M}from"./useHelper-DjwVwIQF.js";import{D as R}from"./DeleteModal-BvdaLGMk.js";import{P as O}from"./PaginationComp-6gfPTlfG.js";import{L as z}from"./LoadingComp-036xVdR_.js";const $={BASE_URL:"/BrunchTime/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_API_NAME:"paul7426",VITE_APP_API_URL:"https://vue3-course-api.hexschool.io"},{VITE_APP_API_NAME:b}=$,G=P("coupons",{state(){return{couponList:[],pagination:{},onLoading:!1}},actions:{async getCoupons(t=0){try{let o=`v2/api/${b}/admin/coupons`;t>0&&(o+=`?page=${t}`),this.onLoading=!0;const{data:u}=await g(o,"get",!0);this.couponList=u.coupons,this.pagination=u.pagination}catch{_()}finally{this.onLoading=!1}},async deleteCoupon(t){var o;try{const u=`v2/api/${b}/admin/coupon/${t}`;this.onLoading=!0;const{data:d}=await g(u,"delete",!0);d.success&&(h(d.message),this.getCoupons())}catch(u){E.isAxiosError(u)&&_(((o=u.response)==null?void 0:o.data.message)||"錯誤!")}finally{this.onLoading=!1}},async updateCoupons(t){var o;try{const u=t.id?`v2/api/${b}/admin/coupon/${t.id}`:`v2/api/${b}/admin/Coupon`,d=t.id?"put":"post";this.onLoading=!0;const{data:n}=await g(u,d,!0,{data:t});n.success&&(h(n.message),this.getCoupons())}catch(u){E.isAxiosError(u)&&_(((o=u.response)==null?void 0:o.data.message)||"錯誤!")}finally{this.onLoading=!1}}}}),x=G,K={props:["coupon"],emits:["updateCoupon"],data(){return{modal:null,cloneCoupon:{}}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},updateDateVal(t){const o=t.target;if(o){const u=new Date(o.value).getTime();this.cloneCoupon.due_date=u/1e3}},updateCoupon(){this.$emit("updateCoupon",this.cloneCoupon),this.closeModal()}},computed:{DatePickerVal(){return this.cloneCoupon.due_date<1?"":M(this.cloneCoupon.due_date).split("/").join("-")}},mounted(){this.modal=new V(this.$refs.CouponModal)},watch:{coupon(){this.cloneCoupon={...this.coupon}}}},W={class:"modal fade",id:"CouponModal",tabindex:"-1","aria-labelledby":"CouponModalLabel","aria-hidden":"true","data-bs-backdrop":"static",ref:"CouponModal"},q={class:"modal-dialog modal-dialog-centered"},J={class:"modal-content"},Q={class:"modal-header bg-accent"},X={class:"modal-title fw-bold fs-2xl",id:"CouponModalLabel"},Y={class:"modal-body"},Z={key:0,class:"mb-3"},oo=["value"],eo={class:"mb-3"},to={class:"mb-3"},no={class:"mb-3"},so={class:"mb-3"},uo={class:"d-flex align-center justify-content-between"},lo={class:"ms-2 fs-sm text-neutral"},ao={class:"mb-5"},io=["value"],po={class:"mb-3 px-3"},ro={class:"form-check form-switch"},co={class:"modal-footer"};function mo(t,o,u,d,n,l){return r(),B(T,{to:"body"},[e("div",W,[e("div",q,[e("div",J,[e("div",Q,[e("h5",X,i(u.coupon.id?"編輯優惠卷":"新增優惠卷"),1),e("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:o[0]||(o[0]=(...s)=>l.closeModal&&l.closeModal(...s))})]),e("div",Y,[n.cloneCoupon.id?(r(),c("div",Z,[o[9]||(o[9]=e("label",{for:"couponId",class:"form-label"},"優惠卷編號",-1)),e("input",{type:"text",class:"form-control",id:"couponId",value:n.cloneCoupon.id,disabled:"",readonly:""},null,8,oo)])):A("",!0),e("div",eo,[o[10]||(o[10]=e("label",{for:"couponTitle",class:"form-label"},"優惠卷名稱",-1)),p(e("input",{type:"text",class:"form-control",id:"couponTitle",placeholder:"請輸入優惠卷名稱","onUpdate:modelValue":o[1]||(o[1]=s=>n.cloneCoupon.title=s)},null,512),[[m,n.cloneCoupon.title]])]),e("div",to,[o[11]||(o[11]=e("label",{for:"couponCode",class:"form-label"},"優惠卷代碼",-1)),p(e("input",{type:"text",class:"form-control",id:"couponCode",placeholder:"請輸入優惠卷代碼","onUpdate:modelValue":o[2]||(o[2]=s=>n.cloneCoupon.code=s)},null,512),[[m,n.cloneCoupon.code]])]),e("div",no,[o[12]||(o[12]=e("label",{for:"couponNum",class:"form-label"},"優惠卷數量",-1)),p(e("input",{type:"number",class:"form-control",id:"couponNum",placeholder:"請輸入優惠卷數量","onUpdate:modelValue":o[3]||(o[3]=s=>n.cloneCoupon.num=s)},null,512),[[m,n.cloneCoupon.num]])]),e("div",so,[o[13]||(o[13]=e("label",{for:"couponTitle",class:"form-label"},"優惠折扣",-1)),e("div",uo,[p(e("input",{type:"range",class:"form-range",max:"100",min:"0",id:"couponTitle",placeholder:"請輸入優惠卷名稱","onUpdate:modelValue":o[4]||(o[4]=s=>n.cloneCoupon.percent=s),style:{width:"calc(100% - 100px)"}},null,512),[[m,n.cloneCoupon.percent,void 0,{number:!0}]]),e("span",lo,i(`${100-n.cloneCoupon.percent} % off`),1)])]),e("div",ao,[o[14]||(o[14]=e("label",{for:"couponDueTo",class:"form-label"},"優惠卷到期日",-1)),e("input",{type:"date",class:"form-control",id:"couponDueTo",value:l.DatePickerVal,onChange:o[5]||(o[5]=(...s)=>l.updateDateVal&&l.updateDateVal(...s))},null,40,io)]),e("div",po,[e("div",ro,[p(e("input",{class:"form-check-input py-2 border border-neutral me-5",type:"checkbox",role:"switch",id:"couponIsEnable","true-value":1,"false-value":0,"onUpdate:modelValue":o[6]||(o[6]=s=>n.cloneCoupon.is_enabled=s),style:{scale:"1.5"}},null,512),[[D,n.cloneCoupon.is_enabled]]),o[15]||(o[15]=e("label",{class:"form-check-label",for:"couponIsEnable"},"是否啟用",-1))])])]),e("div",co,[e("button",{type:"button",class:"px-6 btn btn-outline-neutral",onClick:o[7]||(o[7]=(...s)=>l.closeModal&&l.closeModal(...s))},"取消"),e("button",{type:"button",class:"px-6 btn btn-success",onClick:o[8]||(o[8]=(...s)=>l.updateCoupon&&l.updateCoupon(...s))},i(u.coupon.id?"編輯":"新增"),1)])])])],512)])}const fo=y(K,[["render",mo]]),Co={data(){return{tempCoupon:{},isHideExpired:!1}},computed:{...U(x,["couponList","pagination","onLoading"]),finalCouponList(){if(this.isHideExpired){const t=Date.now()/1e3;return this.couponList.filter(o=>o.due_date>t)}return this.couponList}},methods:{formatDate:M,...N(x,["getCoupons","deleteCoupon","updateCoupons"]),async getNewCoupons(t){await this.getCoupons(t)},getEditCoupon(t){t?this.tempCoupon=t:this.tempCoupon={code:"",due_date:0,num:1,percent:0,title:"",is_enabled:0},this.$refs.couponModal.openModal()},doDeleteCoupon(t){this.tempCoupon=t,this.$refs.delete.openModal()},isDateExpired(t){const o=Math.floor(Date.now()/1e3);return t<o}},components:{CouponModal:fo,DeleteModal:R,Pagination:O,Loading:z},async mounted(){await this.getCoupons()}},bo={class:"container mx-auto"},go={class:"couponWrapper mx-auto"},_o={class:"toolbar mb-3 d-flex align-items-center justify-content-end gap-3"},ho={for:"couponHideExpired",class:"fs-sm"},Eo={class:"mb-10"},vo={class:"couponList"},xo=["onClick"],yo={class:"d-flex flex-wrap align-items-center gap-2"},Ao={class:"fs-xl fw-semibold"},Do={key:0,class:"badge bg-danger"},Mo={class:"fs-sm text-neutral-dark"},wo=["onClick"];function Lo(t,o,u,d,n,l){const s=C("Pagination"),w=C("DeleteModal"),L=C("CouponModal"),F=C("Loading");return r(),c(v,null,[e("div",bo,[e("div",go,[o[4]||(o[4]=e("h2",{class:"fw-bold fs-4xl text-center text-secondary my-10"},"優惠卷管理",-1)),e("div",_o,[e("label",ho,[p(e("input",{type:"checkbox",id:"couponHideExpired",class:"rounded",style:{"accent-color":"var(--bs-accent)"},"onUpdate:modelValue":o[0]||(o[0]=a=>n.isHideExpired=a)},null,512),[[D,n.isHideExpired]]),o[3]||(o[3]=I("  隱藏過期項目"))]),e("button",{type:"button",class:"btn btn-accent",onClick:o[1]||(o[1]=a=>l.getEditCoupon())},"新增優惠卷")]),e("div",Eo,[e("ul",vo,[(r(!0),c(v,null,S(l.finalCouponList,a=>(r(),c("li",{key:a.id,class:"mb-3 mx-auto bg-primary px-4 py-3 d-flex align-items-center justify-content-between rounded-2 cursor-pointer",onClick:k=>l.getEditCoupon(a)},[e("div",yo,[e("p",Ao,i(a.title),1),e("span",{class:H(["badge",a.is_enabled?"bg-success":"bg-neutral"])},i(a.is_enabled?"已啟用":"未啟用"),3),l.isDateExpired(a.due_date)?(r(),c("span",Do," 已過期 ")):A("",!0)]),e("div",Mo,[e("p",null,i(l.formatDate(a.due_date)),1),e("p",null,"剩餘數量: "+i(a.num),1)]),e("div",{class:"position-absolute btn-close bg-neutral p-1 rounded-circle",style:{top:"-0.5rem",right:"-0.5rem"},onClick:j(k=>l.doDeleteCoupon(a),["stop"])},null,8,wo)],8,xo))),128))])]),f(s,{pagination:t.pagination,onUpdatePage:l.getNewCoupons},null,8,["pagination","onUpdatePage"])])]),f(w,{ref:"delete",title:n.tempCoupon.title,"target-id":n.tempCoupon.id,onDeleteTarget:o[2]||(o[2]=async a=>await t.deleteCoupon(a))},null,8,["title","target-id"]),f(L,{ref:"couponModal",coupon:n.tempCoupon,onUpdateCoupon:t.updateCoupons},null,8,["coupon","onUpdateCoupon"]),f(F,{active:t.onLoading},null,8,["active"])],64)}const To=y(Co,[["render",Lo]]);export{To as default};
