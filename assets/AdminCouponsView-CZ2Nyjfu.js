import{L as T,H as g,S as v,A as _,I as h,N as A,_ as M,B as N,a as e,t as u,c,D as w,w as p,v as m,O as D,T as U,o as r,m as I,x as H,e as f,g as B,F as y,z as S,r as b,E as j,d as F}from"./index-Cvp84FeK.js";import{f as L}from"./formatDate-DjwVwIQF.js";import{D as z}from"./DeleteModal-BkLF7irD.js";import{P as O}from"./PaginationComp-Bgzdghs6.js";import{L as W}from"./LoadingComp-AEIi_1e5.js";const $={VITE_APP_API_NAME:"paul7426"},{VITE_APP_API_NAME:C}=$,x=T("coupons",{state(){return{couponList:[],pagination:{},onLoading:!1}},actions:{async getCoupons(t=0){var o;try{let s=`v2/api/${C}/admin/coupons`;t>0&&(s+=`?page=${t}`),this.onLoading=!0;const{data:d}=await g(s,"get",!0);this.couponList=d.coupons,this.pagination=d.pagination}catch(s){s instanceof _&&h(((o=s.response)==null?void 0:o.data.message)||"錯誤!")}finally{this.onLoading=!1}},async deleteCoupon(t){var o;try{const s=`v2/api/${C}/admin/coupon/${t}`;this.onLoading=!0;const{data:d}=await g(s,"delete",!0);d.success&&(v(d.message),this.getCoupons())}catch(s){s instanceof _&&h(((o=s.response)==null?void 0:o.data.message)||"錯誤!")}finally{this.onLoading=!1}},async updateCoupons(t){var o;try{const s=t.id?`v2/api/${C}/admin/coupon/${t.id}`:`v2/api/${C}/admin/Coupon`,d=t.id?"put":"post";this.onLoading=!0;const{data:n}=await g(s,d,!0,{data:t});n.success&&(v(n.message),this.getCoupons())}catch(s){s instanceof _&&h(((o=s.response)==null?void 0:o.data.message)||"錯誤!")}finally{this.onLoading=!1}}}}),q={props:["coupon"],emits:["updateCoupon"],data(){return{modal:null,cloneCoupon:{}}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},updateDateVal(t){const o=t.target;if(o){const s=new Date(o.value).getTime();this.cloneCoupon.due_date=s/1e3}},updateCoupon(){this.$emit("updateCoupon",this.cloneCoupon),this.closeModal()}},computed:{DatePickerVal(){return this.cloneCoupon.due_date<1?"":L(this.cloneCoupon.due_date).split("/").join("-")}},mounted(){this.modal=new A(this.$refs.CouponModal)},watch:{coupon(){this.cloneCoupon={...this.coupon}}}},G={class:"modal fade",id:"CouponModal",tabindex:"-1","aria-labelledby":"CouponModalLabel","aria-hidden":"true","data-bs-backdrop":"static",ref:"CouponModal"},J={class:"modal-dialog modal-dialog-centered"},K={class:"modal-content"},Q={class:"modal-header bg-accent"},R={class:"modal-title fw-bold fs-2xl",id:"CouponModalLabel"},X={class:"modal-body"},Y={key:0,class:"mb-3"},Z=["value"],oo={class:"mb-3"},eo={class:"mb-3"},to={class:"mb-3"},no={class:"mb-3"},so={class:"d-flex align-center justify-content-between"},ao={class:"ms-2 fs-sm text-neutral"},lo={class:"mb-5"},io=["value"],uo={class:"mb-3 px-3"},po={class:"form-check form-switch"},ro={class:"modal-footer"};function co(t,o,s,d,n,l){return r(),N(U,{to:"body"},[e("div",G,[e("div",J,[e("div",K,[e("div",Q,[e("h5",R,u(s.coupon.id?"編輯優惠卷":"新增優惠卷"),1),e("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:o[0]||(o[0]=(...a)=>l.closeModal&&l.closeModal(...a))})]),e("div",X,[n.cloneCoupon.id?(r(),c("div",Y,[o[9]||(o[9]=e("label",{for:"couponId",class:"form-label"},"優惠卷編號",-1)),e("input",{type:"text",class:"form-control",id:"couponId",value:n.cloneCoupon.id,disabled:"",readonly:""},null,8,Z)])):w("",!0),e("div",oo,[o[10]||(o[10]=e("label",{for:"couponTitle",class:"form-label"},"優惠卷名稱",-1)),p(e("input",{type:"text",class:"form-control",id:"couponTitle",placeholder:"請輸入優惠卷名稱","onUpdate:modelValue":o[1]||(o[1]=a=>n.cloneCoupon.title=a)},null,512),[[m,n.cloneCoupon.title]])]),e("div",eo,[o[11]||(o[11]=e("label",{for:"couponCode",class:"form-label"},"優惠卷代碼",-1)),p(e("input",{type:"text",class:"form-control",id:"couponCode",placeholder:"請輸入優惠卷代碼","onUpdate:modelValue":o[2]||(o[2]=a=>n.cloneCoupon.code=a)},null,512),[[m,n.cloneCoupon.code]])]),e("div",to,[o[12]||(o[12]=e("label",{for:"couponNum",class:"form-label"},"優惠卷數量",-1)),p(e("input",{type:"number",class:"form-control",id:"couponNum",placeholder:"請輸入優惠卷數量","onUpdate:modelValue":o[3]||(o[3]=a=>n.cloneCoupon.num=a)},null,512),[[m,n.cloneCoupon.num]])]),e("div",no,[o[13]||(o[13]=e("label",{for:"couponTitle",class:"form-label"},"優惠折扣",-1)),e("div",so,[p(e("input",{type:"range",class:"form-range",max:"100",min:"0",id:"couponTitle",placeholder:"請輸入優惠卷名稱","onUpdate:modelValue":o[4]||(o[4]=a=>n.cloneCoupon.percent=a),style:{width:"calc(100% - 100px)"}},null,512),[[m,n.cloneCoupon.percent,void 0,{number:!0}]]),e("span",ao,u(`${100-n.cloneCoupon.percent} % off`),1)])]),e("div",lo,[o[14]||(o[14]=e("label",{for:"couponDueTo",class:"form-label"},"優惠卷到期日",-1)),e("input",{type:"date",class:"form-control",id:"couponDueTo",value:l.DatePickerVal,onChange:o[5]||(o[5]=(...a)=>l.updateDateVal&&l.updateDateVal(...a))},null,40,io)]),e("div",uo,[e("div",po,[p(e("input",{class:"form-check-input py-2 border border-neutral me-5",type:"checkbox",role:"switch",id:"couponIsEnable","true-value":1,"false-value":0,"onUpdate:modelValue":o[6]||(o[6]=a=>n.cloneCoupon.is_enabled=a),style:{scale:"1.5"}},null,512),[[D,n.cloneCoupon.is_enabled]]),o[15]||(o[15]=e("label",{class:"form-check-label",for:"couponIsEnable"},"是否啟用",-1))])])]),e("div",ro,[e("button",{type:"button",class:"px-6 btn btn-outline-neutral",onClick:o[7]||(o[7]=(...a)=>l.closeModal&&l.closeModal(...a))},"取消"),e("button",{type:"button",class:"px-6 btn btn-success",onClick:o[8]||(o[8]=(...a)=>l.updateCoupon&&l.updateCoupon(...a))},u(s.coupon.id?"編輯":"新增"),1)])])])],512)])}const mo=M(q,[["render",co]]),fo={data(){return{tempCoupon:{},isHideExpired:!1}},computed:{...H(x,["couponList","pagination","onLoading"]),finalCouponList(){if(this.isHideExpired){const t=Date.now()/1e3;return this.couponList.filter(o=>o.due_date>t)}return this.couponList}},methods:{formatDate:L,...I(x,["getCoupons","deleteCoupon","updateCoupons"]),async getNewCoupons(t){await this.getCoupons(t)},getEditCoupon(t){t?this.tempCoupon=t:this.tempCoupon={code:"",due_date:0,num:1,percent:0,title:"",is_enabled:0},this.$refs.couponModal.openModal()},doDeleteCoupon(t){this.tempCoupon=t,this.$refs.delete.openModal()},isDateExpired(t){const o=Math.floor(Date.now()/1e3);return t<o}},components:{CouponModal:mo,DeleteModal:z,Pagination:O,Loading:W},async mounted(){await this.getCoupons()}},bo={class:"container mx-auto"},Co={class:"couponWrapper mx-auto"},go={class:"toolbar mb-3 d-flex align-items-center justify-content-end gap-3"},_o={for:"couponHideExpired",class:"fs-sm"},ho={class:"mb-10"},vo={class:"couponList"},yo=["onClick"],xo={class:"d-flex flex-wrap align-items-center gap-2"},Mo={class:"fs-xl fw-semibold"},wo={key:0,class:"badge bg-danger"},Do={class:"fs-sm text-neutral-dark"},Lo=["onClick"];function ko(t,o,s,d,n,l){const a=b("Pagination"),k=b("DeleteModal"),E=b("CouponModal"),V=b("Loading");return r(),c(y,null,[e("div",bo,[e("div",Co,[o[4]||(o[4]=e("h2",{class:"fw-bold fs-4xl text-center text-secondary my-10"},"優惠卷管理",-1)),e("div",go,[e("label",_o,[p(e("input",{type:"checkbox",id:"couponHideExpired",class:"rounded",style:{"accent-color":"var(--bs-accent)"},"onUpdate:modelValue":o[0]||(o[0]=i=>n.isHideExpired=i)},null,512),[[D,n.isHideExpired]]),o[3]||(o[3]=B("  隱藏過期項目",-1))]),e("button",{type:"button",class:"btn btn-accent",onClick:o[1]||(o[1]=i=>l.getEditCoupon())},"新增優惠卷")]),e("div",ho,[e("ul",vo,[(r(!0),c(y,null,S(l.finalCouponList,i=>(r(),c("li",{key:i.id,class:"mb-3 mx-auto bg-primary px-4 py-3 d-flex align-items-center justify-content-between rounded-2 cursor-pointer",onClick:P=>l.getEditCoupon(i)},[e("div",xo,[e("p",Mo,u(i.title),1),e("span",{class:j(["badge",i.is_enabled?"bg-success":"bg-neutral"])},u(i.is_enabled?"已啟用":"未啟用"),3),l.isDateExpired(i.due_date)?(r(),c("span",wo," 已過期 ")):w("",!0)]),e("div",Do,[e("p",null,u(l.formatDate(i.due_date)),1),e("p",null,"剩餘數量: "+u(i.num),1)]),e("div",{class:"position-absolute btn-close bg-neutral p-1 rounded-circle",style:{top:"-0.5rem",right:"-0.5rem"},onClick:F(P=>l.doDeleteCoupon(i),["stop"])},null,8,Lo)],8,yo))),128))])]),f(a,{pagination:t.pagination,onUpdatePage:l.getNewCoupons},null,8,["pagination","onUpdatePage"])])]),f(k,{ref:"delete",title:n.tempCoupon.title,"target-id":n.tempCoupon.id,onDeleteTarget:o[2]||(o[2]=async i=>await t.deleteCoupon(i))},null,8,["title","target-id"]),f(E,{ref:"couponModal",coupon:n.tempCoupon,onUpdateCoupon:t.updateCoupons},null,8,["coupon","onUpdateCoupon"]),f(V,{active:t.onLoading},null,8,["active"])],64)}const No=M(fo,[["render",ko]]);export{No as default};
