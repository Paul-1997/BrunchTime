import{m as D,N as V,_ as w,A as k,a as e,e as u,f as v,T as M,r as g,o as a,w as x,U as B,D as f,c as m,z as O,t as l,F as b,B as L,g as _,J as A,x as N}from"./index-C3VS7dNT.js";import{P as q}from"./PaginationComp-6gfPTlfG.js";import{D as S}from"./DeleteModal-BvdaLGMk.js";import{o as F}from"./orderStore-pPe-bkIF.js";import{p as U}from"./productStore-DHSJnlch.js";import{f as I}from"./useHelper-DjwVwIQF.js";import{L as T}from"./LoadingComp-036xVdR_.js";const $={props:["order","formatDate"],emits:["updateOrder"],data(){return{modal:null,deepCloneOrder:{user:{name:"",tel:"",email:"",address:""}},itemList:[]}},methods:{...D(U,["getAllProducts"]),openModal(){this.modal.show()},closeModal(){this.deepCloneOrder=JSON.parse(JSON.stringify(this.order)),this.$refs.form.resetForm({value:{orderUserName:this.deepCloneOrder.user.name,orderUserEmail:this.deepCloneOrder.user.email,orderUserTel:this.deepCloneOrder.user.tel,orderUserAddress:this.deepCloneOrder.user.address},touched:!1}),this.modal.hide()},updateItem(d,t){const n=this.deepCloneOrder.products[t],{price:C}=d;n.product.id!==d.id&&(n.product=d,n.qty=1,n.final_total=C*n.qty,n.total=C*n.qty,this.updateTotal())},updateQty(d){const t=this.deepCloneOrder.products[d],{price:n}=t.product;t.final_total=n*t.qty,t.total=n*t.qty,this.updateTotal()},updateTotal(){this.deepCloneOrder.total=Object.values(this.deepCloneOrder.products).reduce((d,t)=>d+t.qty*t.product.price,0)},addNewItem(d){const t=()=>`-${crypto.randomUUID()} `,{price:n,id:C}=d,r=t(),i={id:r,product_id:C,product:d,qty:1,final_total:n*1,total:n*1};this.deepCloneOrder.products[r]=i,this.updateTotal()},removeOrderItem(d){this.deepCloneOrder.products=Object.fromEntries(Object.entries(this.deepCloneOrder.products).filter(([t])=>t!==d)),this.updateTotal()},updateOrder(){this.$emit("updateOrder",this.deepCloneOrder),this.closeModal()}},async mounted(){this.modal=new V(this.$refs.orderEdit);const{products:d}=await this.getAllProducts("admin");this.itemList=d},watch:{order(){this.deepCloneOrder=JSON.parse(JSON.stringify(this.order))}}},P={class:"modal fade",id:"orderEdit",tabindex:"-1","aria-labelledby":"orderEditLabel","aria-hidden":"true","data-bs-backdrop":"static",ref:"orderEdit"},j={class:"modal-dialog modal-dialog-centered"},J={class:"modal-content"},z={class:"modal-header bg-primary"},Q={class:"modal-body"},R={class:"mb-3"},X=["value"],G={class:"mb-3"},H=["value"],K={class:"d-flex align-items-center mb-3"},W={class:"table table-hover align-middle"},Y=["data-id"],Z={class:"fw-semibold itemListDropdown"},ee={class:"form-control p-0 cursor-pointer"},te={class:"d-flex align-items-center dropdown-toggle",id:"itemListDropdown","data-bs-toggle":"dropdown","aria-expanded":"false"},se={style:{padding:"0.125rem",flex:"0 0 48px"},class:"me-1"},re=["src"],oe={class:"overflow-hidden"},de={class:"dropdown-menu","aria-labelledby":"itemListDropdown"},le=["onClick"],ne={style:{padding:"0.125rem",flex:"0 0 48px"},class:"me-1"},ie=["src"],ae={class:"overflow-hidden"},ue={width:"48px"},me=["onChange","onUpdate:modelValue"],pe=["value"],ce=["onClick"],be={colspan:"5"},_e={class:"dropdown-menu","aria-labelledby":"itemListDropdown2"},fe=["onClick"],ge={style:{padding:"0.125rem",flex:"0 0 48px"},class:"me-1"},Oe=["src"],Ce={class:"overflow-hidden"},ye={class:"text-end fs-lg"},he={class:"mb-3"},ve={class:"mb-3"},Ae={class:"mb-3"},Ee={class:"mb-3"},xe={class:"mb-3"},De={class:"p-1 border border-neutral-light text-neutral bg-mute rounded",style:{"min-height":"100px"}},Be={class:"modal-footer py-2"};function Fe(d,t,n,C,r,i){const y=g("VeeField"),h=g("VeeErrorMessage"),E=g("VeeForm");return a(),k(M,{to:"body"},[e("div",P,[e("div",j,[e("div",J,[e("div",z,[t[8]||(t[8]=e("h5",{id:"orderEditLabel",class:"modal-title fw-bold"},"編輯訂單",-1)),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...c)=>i.closeModal&&i.closeModal(...c)),"aria-label":"Close"})]),u(E,{ref:"form",onSubmit:i.updateOrder,initialValues:{orderUserName:r.deepCloneOrder.user.name,orderUserEmail:r.deepCloneOrder.user.email,orderUserTel:r.deepCloneOrder.user.tel,orderUserAddress:r.deepCloneOrder.user.address},validateOnMount:!0},{default:v(({errors:c})=>[e("div",Q,[e("div",R,[t[9]||(t[9]=e("label",{for:"editOrderId",class:"form-label"},"訂單編號",-1)),e("input",{type:"text",id:"editOrderId",value:n.order.id,class:"form-control",disabled:"",readonly:""},null,8,X)]),e("div",G,[t[10]||(t[10]=e("label",{for:"editOrderDate",class:"form-label"},"訂購時間",-1)),e("input",{type:"text",id:"editOrderDate",value:n.formatDate(n.order.create_at,!0),class:"form-control",disabled:"",readonly:""},null,8,H)]),e("div",K,[t[11]||(t[11]=e("span",{class:"me-3"},"付款狀態:",-1)),x(e("input",{type:"radio",class:"btn-check",name:"payment_options",id:"payment_options1",autocomplete:"off","onUpdate:modelValue":t[1]||(t[1]=s=>r.deepCloneOrder.is_paid=s),value:!0},null,512),[[B,r.deepCloneOrder.is_paid]]),e("label",{class:f(["btn btn-sm me-2",r.deepCloneOrder.is_paid?"btn-success":"btn-outline-neutral"]),for:"payment_options1"},"已付款",2),x(e("input",{type:"radio",class:"btn-check",name:"payment_options",id:"payment_options2",autocomplete:"off","onUpdate:modelValue":t[2]||(t[2]=s=>r.deepCloneOrder.is_paid=s),value:!1},null,512),[[B,r.deepCloneOrder.is_paid]]),e("label",{class:f(["btn btn-sm",r.deepCloneOrder.is_paid?"btn-outline-neutral":"btn-neutral"]),for:"payment_options2"},"未付款",2)]),t[19]||(t[19]=e("h3",{class:"fs-xl fw-semibold border-bottom mb-3"},"訂購項目",-1)),e("table",W,[t[13]||(t[13]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"產品"),e("th",{scope:"col"},"單價"),e("th",{scope:"col"},"數量"),e("th",{scope:"col"},"總計"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(a(!0),m(b,null,O(r.deepCloneOrder.products,s=>(a(),m("tr",{key:s.id,"data-id":s.id},[e("td",Z,[e("div",ee,[e("div",te,[e("picture",se,[e("img",{src:s.product.imageUrl,alt:"",style:{"aspect-ratio":"1"}},null,8,re)]),e("span",oe,l(s.product.title),1)]),e("ul",de,[(a(!0),m(b,null,O(r.itemList,o=>(a(),m("li",{key:o.id},[e("div",{class:"d-flex align-items-center",onClick:p=>i.updateItem(o,s.id)},[e("picture",ne,[e("img",{src:o.imageUrl,alt:"",style:{"aspect-ratio":"1"}},null,8,ie)]),e("span",ae,l(o.title),1)],8,le)]))),128))])])]),e("td",ue,l(s.product.price),1),e("td",null,[x(e("select",{class:"form-select",onChange:o=>i.updateQty(s.id),"onUpdate:modelValue":o=>s.qty=o,style:{width:"50px","background-position-x":"28px",padding:"0.25rem"}},[(a(),m(b,null,O(20,o=>e("option",{value:o,key:`qty${o}`},l(o),9,pe)),64))],40,me),[[L,s.qty]])]),e("td",null,"$"+l(s.final_total),1),e("td",null,[e("button",{class:"btn btn-danger px-2 py-0",onClick:o=>i.removeOrderItem(s.id)},"X",8,ce)])],8,Y))),128)),e("tr",null,[e("td",be,[t[12]||(t[12]=e("button",{class:"mx-auto d-flex align-item-center justify-content-center btn text-neutral border-bottom",type:"button",id:"itemListDropdown2","data-bs-toggle":"dropdown","aria-expanded":"false",role:"button"},[e("span",{class:"material-symbols-outlined"},"add_circle"),_("新增產品 ")],-1)),e("ul",_e,[(a(!0),m(b,null,O(r.itemList,s=>(a(),m("li",{key:s.id},[e("div",{class:"d-flex align-items-center",onClick:o=>i.addNewItem(s)},[e("picture",ge,[e("img",{src:s.imageUrl,alt:"",style:{"aspect-ratio":"1"}},null,8,Oe)]),e("span",Ce,l(s.title),1)],8,fe)]))),128))])])])])]),e("div",ye,"總計金額$ "+l(r.deepCloneOrder.total)+" 元",1),t[20]||(t[20]=e("h3",{class:"fs-xl fw-semibold border-bottom mb-3"},"訂購人資訊",-1)),e("div",he,[t[14]||(t[14]=e("label",{for:"editOrderUserName",class:"form-label"},"訂購人名稱 ",-1)),u(y,{modelValue:r.deepCloneOrder.user.name,"onUpdate:modelValue":t[3]||(t[3]=s=>r.deepCloneOrder.user.name=s),type:"text",rules:"required",name:"OrderUserName",value:r.deepCloneOrder.user.name,label:"訂購人名稱"},{default:v(({field:s,meta:o})=>[e("input",A({id:"editOrderUserName"},s,{class:["form-control",{"is-invalid":c.OrderUserName,"is-valid":o.valid&&o.touched}]}),null,16)]),_:2},1032,["modelValue","value"]),u(h,{name:"OrderUserName",class:"Vee__errMsg"})]),e("div",ve,[t[15]||(t[15]=e("label",{for:"editOrderUserTel",class:"form-label"},"訂購人電話 ",-1)),u(y,{modelValue:r.deepCloneOrder.user.tel,"onUpdate:modelValue":t[4]||(t[4]=s=>r.deepCloneOrder.user.tel=s),modelModifiers:{number:!0},type:"number",rules:"numeric|required",name:"OrderUserTel",value:r.deepCloneOrder.user.tel,label:"訂購人電話"},{default:v(({field:s,meta:o})=>[e("input",A({id:"editOrderUserTel",inputmode:"numeric"},s,{class:["form-control",{"is-invalid":c.OrderUserName,"is-valid":o.valid&&o.touched}]}),null,16)]),_:2},1032,["modelValue","value"]),u(h,{name:"OrderUserTel",class:"Vee__errMsg"})]),e("div",Ae,[t[16]||(t[16]=e("label",{for:"editOrderUserEmail",class:"form-label"},"訂購人信箱 ",-1)),u(y,{modelValue:r.deepCloneOrder.user.email,"onUpdate:modelValue":t[5]||(t[5]=s=>r.deepCloneOrder.user.email=s),type:"email",rules:"email|required",name:"OrderUserEmail",value:r.deepCloneOrder.user.email,label:"訂購人信箱"},{default:v(({field:s,meta:o})=>[e("input",A({id:"editOrderUserEmail"},s,{class:["form-control",{"is-invalid":c.OrderUserName,"is-valid":o.valid&&o.touched}]}),null,16)]),_:2},1032,["modelValue","value"]),u(h,{name:"OrderUserEmail",class:"Vee__errMsg"})]),e("div",Ee,[t[17]||(t[17]=e("label",{for:"editOrderUserAddress",class:"form-label"},"訂購人地址 ",-1)),u(y,{modelValue:r.deepCloneOrder.user.address,"onUpdate:modelValue":t[6]||(t[6]=s=>r.deepCloneOrder.user.address=s),type:"text",rules:"required",name:"OrderUserAddress",value:r.deepCloneOrder.user.address,label:"訂購人電話"},{default:v(({field:s,meta:o})=>[e("input",A({id:"editOrderUserAddress",inputmode:"numeric"},s,{class:["form-control",{"is-invalid":c.OrderUserName,"is-valid":o.valid&&o.touched}]}),null,16)]),_:2},1032,["modelValue","value"]),u(h,{name:"OrderUserAddress",class:"Vee__errMsg"})]),e("div",xe,[t[18]||(t[18]=e("h3",{class:"fs-xl fw-semibold"},"訂單備註",-1)),e("p",De,l(n.order.message?n.order.message:"無備註內容"),1)])]),e("div",Be,[e("button",{type:"button",class:"btn px-6 py-1 btn-outline-neutral",onClick:t[7]||(t[7]=(...s)=>i.closeModal&&i.closeModal(...s))},"取消"),t[21]||(t[21]=e("button",{type:"submit",class:"btn px-6 py-1 btn-success"},"送出",-1))])]),_:1},8,["onSubmit","initialValues"])])])],512)])}const we=w($,[["render",Fe],["__scopeId","data-v-7466c1ff"]]),Ue={data(){return{tempOrder:{},onEdit:!1,currFilter:"全部",OrderSortBy:"最新"}},methods:{...D(F,["getOrders","updateOrder","deleteOrder"]),...D(U,["getAllProducts"]),async getNewOrder(d){await this.getOrders("admin",d)},getModal(d){this.$refs[d].openModal()},editOrder(d){this.tempOrder=d,this.getModal("edit")},getDeleteOrder(d){this.tempOrder=d,this.getModal("delete")},formatDate:I},computed:{...N(F,["orderList","pagination","onLoading"]),finalOrder(){return[...this.orderList].filter(t=>this.currFilter==="全部"?!0:(t.is_paid?"已付款":"未付款")===this.currFilter).sort((t,n)=>this.OrderSortBy==="最新"?t.create_at-n.create_at:n.create_at-t.create_at)}},async mounted(){await this.getOrders("admin")},components:{DeleteModal:S,OrderModal:we,Pagination:q,Loading:T}},Ve={class:"container mx-auto"},ke={class:"toolbar mb-3"},Me={class:"d-flex flex-wrap align-items-center justify-content-md-between"},Le={class:"d-flex align-items-center gap-3"},Ne={class:"dropdown"},qe={class:"btn btn-sm btn-outline-neutral dropdown-toggle",type:"button",id:"dropdown__OrderSorter","data-bs-toggle":"dropdown","aria-expanded":"false"},Se={class:"dropdown-menu","aria-labelledby":"dropdown__OrderSorter"},Ie=["onClick"],Te={class:"mb-10"},$e={class:"accordion",id:"adminOrderList"},Pe=["id"],je=["data-bs-target","aria-controls"],Je={class:"badge bg-secondary d-none d-md-inline me-1"},ze={class:"fw-bold fs-lg text-dark"},Qe=["id","aria-labelledby"],Re={class:"accordion-body"},Xe={class:"mb-2"},Ge={class:"mb-2"},He={class:"mb-5"},Ke={class:"mb-5 d-flex flex-wrap gap-4"},We=["src"],Ye={class:"flex-grow-1 me-auto"},Ze={class:"ms-1"},et={class:"ms-2"},tt={class:"text-end fw-semibold fs-lg"},st={class:"fs-base"},rt={class:"mb-5"},ot={class:"mb-3"},dt={class:"mb-3"},lt={class:"mb-3"},nt={class:"mb-3"},it={class:"p-1 text-neutral bg-mute rounded",style:{"min-height":"100px"}},at={class:"accordion-footer px-4 py-2 text-end border-top"},ut=["onClick"],mt=["onClick"];function pt(d,t,n,C,r,i){const y=g("Pagination"),h=g("DeleteModal"),E=g("OrderModal"),c=g("Loading");return a(),m(b,null,[e("div",Ve,[t[13]||(t[13]=e("h2",{class:"fw-bold fs-4xl text-center text-secondary my-10"},"訂單管理",-1)),e("div",ke,[e("div",Me,[e("div",Le,[e("button",{type:"button",class:f([r.currFilter==="全部"?"btn-primary":"btn-neutral-light","btn border-0 px-4 py-1"]),onClick:t[0]||(t[0]=s=>r.currFilter="全部")}," 全部 ",2),e("button",{type:"button",class:f([r.currFilter==="已付款"?"btn-primary":"btn-neutral-light","btn border-0 px-4 py-1"]),onClick:t[1]||(t[1]=s=>r.currFilter="已付款")}," 已付款 ",2),e("button",{type:"button",class:f([r.currFilter==="未付款"?"btn-primary":"btn-neutral-light","btn border-0 px-4 py-1"]),onClick:t[2]||(t[2]=s=>r.currFilter="未付款")}," 未付款 ",2)]),e("div",Ne,[e("button",qe,l(r.OrderSortBy),1),e("ul",Se,[(a(),m(b,null,O(["最新","最舊"],s=>e("li",{class:"dropdown-item cursor-pointer",key:s,onClick:o=>r.OrderSortBy=s},l(s),9,Ie)),64))])])])]),e("div",Te,[e("div",$e,[(a(!0),m(b,null,O(i.finalOrder,(s,o)=>(a(),m("div",{key:s.id,class:"accordion-item rounded-bottom rounded-2 overflow-hidden mb-3"},[e("h2",{class:"accordion-header",id:`order${o}`},[e("button",{class:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":`#orderItem${o+1}`,"aria-expanded":"false","aria-controls":`orderItem${o+1}`,style:{"background-color":"var(--bs-primary)","box-shadow":"none"}},[e("div",Je,l(i.formatDate(s.create_at)),1),e("span",{class:f(["badge me-3",s.is_paid?"bg-success":"bg-neutral"])},l(s.is_paid?"已付款":"未付款"),3),e("span",ze,l(`訂單${s.id}`),1)],8,je)],8,Pe),e("div",{id:`orderItem${o+1}`,class:"accordion-collapse collapse","aria-labelledby":`order${o}`,"data-bs-parent":"#adminOrderList"},[e("div",Re,[e("div",Xe,[e("span",null,"訂單編號: "+l(s.id),1)]),e("div",Ge,[e("span",null,"詳細日期: "+l(i.formatDate(s.create_at,!0)),1)]),e("div",He,[t[4]||(t[4]=e("span",null," 付款狀態: ",-1)),e("span",{class:f(["badge me-3 align-middle",s.is_paid?"bg-success":"bg-neutral"])},l(s.is_paid?"已付款":"未付款"),3)]),t[10]||(t[10]=e("h3",{class:"mb-3 fs-xl border-bottom"},"訂單資訊",-1)),e("div",Ke,[(a(!0),m(b,null,O(s.products,p=>(a(),m("div",{key:p.id,class:"p-1 bg-primary d-flex align-items-center mb-3",style:{"max-width":"320px"}},[e("img",{src:p.product.imageUrl,alt:"",style:{width:"40px","aspect-ratio":"1"},class:"me-2"},null,8,We),e("p",Ye,[_(l(p.product.title)+" ",1),e("span",Ze,l(p.qty)+"("+l(p.product.unit)+")",1)]),e("p",et,"共"+l(p.final_total)+"元",1)]))),128))]),e("p",tt,[t[5]||(t[5]=_(" 總計: ")),e("span",st,l(s.total),1)]),t[11]||(t[11]=e("h3",{class:"mb-3 fs-xl border-bottom"},"訂購人資訊",-1)),e("ul",rt,[e("li",ot,[t[6]||(t[6]=e("span",{class:"me-2"},"訂購人名稱:",-1)),_(l(s.user.name),1)]),e("li",dt,[t[7]||(t[7]=e("span",{class:"me-2"},"訂購人電話:",-1)),_(l(s.user.tel),1)]),e("li",lt,[t[8]||(t[8]=e("span",{class:"me-2"},"訂購人信箱:",-1)),_(l(s.user.email),1)]),e("li",nt,[t[9]||(t[9]=e("span",{class:"me-2"},"訂購人地址:",-1)),_(l(s.user.address),1)])]),t[12]||(t[12]=e("h3",{class:"mb-3 fs-xl border-bottom"},"訂單備註",-1)),e("p",it,l(s.message?s.message:"無備註內容"),1)]),e("div",at,[e("button",{type:"button",class:"btn px-6 py-1 bg-danger text-white me-4 bg-hover-danger",onClick:p=>i.getDeleteOrder(s)}," 刪除 ",8,ut),e("button",{type:"button",class:"btn px-6 py-1 bg-primary bg-hover-accent",onClick:p=>i.editOrder(s)}," 編輯 ",8,mt)])],8,Qe)]))),128))])]),u(y,{pagination:d.pagination,onUpdatePage:i.getNewOrder},null,8,["pagination","onUpdatePage"])]),u(h,{ref:"delete",title:r.tempOrder.id,"target-id":r.tempOrder.id,onDeleteTarget:t[3]||(t[3]=async s=>await d.deleteOrder(s))},null,8,["title","target-id"]),u(E,{ref:"edit",order:r.tempOrder,formatDate:i.formatDate,onUpdateOrder:d.updateOrder},null,8,["order","formatDate","onUpdateOrder"]),u(c,{active:d.onLoading},null,8,["active"])],64)}const yt=w(Ue,[["render",pt],["__scopeId","data-v-10b75e41"]]);export{yt as default};
