import{m as M,N as L,_ as D,B as N,a as e,e as m,f as x,r as g,T as I,o as a,w as U,U as V,E as f,c as u,F as b,z as O,t as l,C as q,g as _,K as C,x as E}from"./index-Cvp84FeK.js";import{P as S}from"./PaginationComp-Bgzdghs6.js";import{D as F}from"./DeleteModal-BkLF7irD.js";import{o as k}from"./orderStore-mTS2Tg5Z.js";import{p as T}from"./productStore-C97PhnbI.js";import{f as $}from"./formatDate-DjwVwIQF.js";import{L as A}from"./LoadingComp-AEIi_1e5.js";const B={props:["order","formatDate"],emits:["updateOrder"],data(){return{modal:null,deepCloneOrder:{user:{name:"",tel:"",email:"",address:""}},itemList:[]}},methods:{openModal(){this.modal.show()},closeModal(){this.deepCloneOrder=JSON.parse(JSON.stringify(this.order)),this.$refs.form.resetForm({value:{orderUserName:this.deepCloneOrder.user.name,orderUserEmail:this.deepCloneOrder.user.email,orderUserTel:this.deepCloneOrder.user.tel,orderUserAddress:this.deepCloneOrder.user.address},touched:!1}),this.modal.hide()},updateItem(o,t){const n=this.deepCloneOrder.products[t],{price:y}=o;n.product.id!==o.id&&(n.product=o,n.qty=1,n.final_total=y*n.qty,n.total=y*n.qty,this.updateTotal())},updateQty(o){const t=this.deepCloneOrder.products[o],{price:n}=t.product;t.final_total=n*t.qty,t.total=n*t.qty,this.updateTotal()},updateTotal(){this.deepCloneOrder.total=Object.values(this.deepCloneOrder.products).reduce((o,t)=>o+t.qty*t.product.price,0)},addNewItem(o){const t=()=>`-${crypto.randomUUID()} `,{price:n,id:y}=o,r=t(),i={id:r,product_id:y,product:o,qty:1,final_total:n*1,total:n*1};this.deepCloneOrder.products[r]=i,this.updateTotal()},removeOrderItem(o){this.deepCloneOrder.products=Object.fromEntries(Object.entries(this.deepCloneOrder.products).filter(([t])=>t!==o)),this.updateTotal()},updateOrder(){this.$emit("updateOrder",this.deepCloneOrder),this.closeModal()},...M(T,["getAllProducts"])},computed:{productItemList(){return this.itemList}},async mounted(){this.modal=new L(this.$refs.orderEdit);const o=await this.getAllProducts("admin")||[];this.itemList=Object.values(o)},watch:{order(){this.deepCloneOrder=JSON.parse(JSON.stringify(this.order))}}},P={class:"modal fade",id:"orderEdit",tabindex:"-1","aria-labelledby":"orderEditLabel","aria-hidden":"true","data-bs-backdrop":"static",ref:"orderEdit"},j={class:"modal-dialog modal-dialog-centered"},J={class:"modal-content"},z={class:"modal-header bg-primary"},Q={class:"modal-body"},K={class:"mb-3"},R=["value"],X={class:"mb-3"},G=["value"],H={class:"d-flex align-items-center mb-3"},W={class:"table table-hover align-middle"},Y=["data-id"],Z={class:"fw-semibold itemListDropdown"},ee={class:"form-control p-0 cursor-pointer"},te={class:"d-flex align-items-center dropdown-toggle",id:"itemListDropdown","data-bs-toggle":"dropdown","aria-expanded":"false"},se={style:{padding:"0.125rem",flex:"0 0 48px"},class:"me-1"},re=["src"],de={class:"overflow-hidden"},oe={class:"dropdown-menu","aria-labelledby":"itemListDropdown"},le=["onClick"],ne={style:{padding:"0.125rem",flex:"0 0 48px"},class:"me-1"},ie=["src"],ae={class:"overflow-hidden"},me={width:"48px"},ue=["onChange","onUpdate:modelValue"],ce=["value"],pe=["onClick"],be={colspan:"5"},_e={class:"dropdown-menu","aria-labelledby":"itemListDropdown2"},fe=["onClick"],ge={style:{padding:"0.125rem",flex:"0 0 48px"},class:"me-1"},Oe=["src"],ye={class:"overflow-hidden"},he={class:"text-end fs-lg"},ve={class:"mb-3"},xe={class:"mb-3"},Ce={class:"mb-3"},we={class:"mb-3"},Ue={class:"mb-3"},Ve={class:"p-1 border border-neutral-light text-neutral bg-mute rounded",style:{"min-height":"100px"}},ke={class:"modal-footer py-2"};function Me(o,t,n,y,r,i){const h=g("VeeField"),v=g("VeeErrorMessage"),w=g("VeeForm");return a(),N(I,{to:"body"},[e("div",P,[e("div",j,[e("div",J,[e("div",z,[t[8]||(t[8]=e("h5",{id:"orderEditLabel",class:"modal-title fw-bold"},"編輯訂單",-1)),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...p)=>i.closeModal&&i.closeModal(...p)),"aria-label":"Close"})]),m(w,{ref:"form",onSubmit:i.updateOrder,initialValues:{orderUserName:r.deepCloneOrder.user.name,orderUserEmail:r.deepCloneOrder.user.email,orderUserTel:r.deepCloneOrder.user.tel,orderUserAddress:r.deepCloneOrder.user.address},validateOnMount:!0},{default:x(({errors:p})=>[e("div",Q,[e("div",K,[t[9]||(t[9]=e("label",{for:"editOrderId",class:"form-label"},"訂單編號",-1)),e("input",{type:"text",id:"editOrderId",value:n.order.id,class:"form-control",disabled:"",readonly:""},null,8,R)]),e("div",X,[t[10]||(t[10]=e("label",{for:"editOrderDate",class:"form-label"},"訂購時間",-1)),e("input",{type:"text",id:"editOrderDate",value:n.formatDate(n.order.create_at,!0),class:"form-control",disabled:"",readonly:""},null,8,G)]),e("div",H,[t[11]||(t[11]=e("span",{class:"me-3"},"付款狀態:",-1)),U(e("input",{type:"radio",class:"btn-check",name:"payment_options",id:"payment_options1",autocomplete:"off","onUpdate:modelValue":t[1]||(t[1]=s=>r.deepCloneOrder.is_paid=s),value:!0},null,512),[[V,r.deepCloneOrder.is_paid]]),e("label",{class:f(["btn btn-sm me-2",r.deepCloneOrder.is_paid?"btn-success":"btn-outline-neutral"]),for:"payment_options1"},"已付款",2),U(e("input",{type:"radio",class:"btn-check",name:"payment_options",id:"payment_options2",autocomplete:"off","onUpdate:modelValue":t[2]||(t[2]=s=>r.deepCloneOrder.is_paid=s),value:!1},null,512),[[V,r.deepCloneOrder.is_paid]]),e("label",{class:f(["btn btn-sm",r.deepCloneOrder.is_paid?"btn-outline-neutral":"btn-neutral"]),for:"payment_options2"},"未付款",2)]),t[19]||(t[19]=e("h3",{class:"fs-xl fw-semibold border-bottom mb-3"},"訂購項目",-1)),e("table",W,[t[13]||(t[13]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"產品"),e("th",{scope:"col"},"單價"),e("th",{scope:"col"},"數量"),e("th",{scope:"col"},"總計"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(a(!0),u(b,null,O(r.deepCloneOrder.products,s=>(a(),u("tr",{key:s.id,"data-id":s.id},[e("td",Z,[e("div",ee,[e("div",te,[e("picture",se,[e("img",{src:s.product.imageUrl,alt:"",style:{"aspect-ratio":"1"}},null,8,re)]),e("span",de,l(s.product.title),1)]),e("ul",oe,[(a(!0),u(b,null,O(i.productItemList,d=>(a(),u("li",{key:d.id},[e("div",{class:"d-flex align-items-center",onClick:c=>i.updateItem(d,s.id)},[e("picture",ne,[e("img",{src:d.imageUrl,alt:"",style:{"aspect-ratio":"1"}},null,8,ie)]),e("span",ae,l(d.title),1)],8,le)]))),128))])])]),e("td",me,l(s.product.price),1),e("td",null,[U(e("select",{class:"form-select",onChange:d=>i.updateQty(s.id),"onUpdate:modelValue":d=>s.qty=d,style:{width:"50px","background-position-x":"28px",padding:"0.25rem"}},[(a(),u(b,null,O(20,d=>e("option",{value:d,key:`qty${d}`},l(d),9,ce)),64))],40,ue),[[q,s.qty]])]),e("td",null,"$"+l(s.final_total),1),e("td",null,[e("button",{class:"btn btn-danger px-2 py-0",onClick:d=>i.removeOrderItem(s.id)},"X",8,pe)])],8,Y))),128)),e("tr",null,[e("td",be,[t[12]||(t[12]=e("button",{class:"mx-auto d-flex align-item-center justify-content-center btn text-neutral border-bottom",type:"button",id:"itemListDropdown2","data-bs-toggle":"dropdown","aria-expanded":"false",role:"button"},[e("span",{class:"material-symbols-outlined"},"add_circle"),_("新增產品 ")],-1)),e("ul",_e,[(a(!0),u(b,null,O(i.productItemList,s=>(a(),u("li",{key:s.id},[e("div",{class:"d-flex align-items-center",onClick:d=>i.addNewItem(s)},[e("picture",ge,[e("img",{src:s.imageUrl,alt:"",style:{"aspect-ratio":"1"}},null,8,Oe)]),e("span",ye,l(s.title),1)],8,fe)]))),128))])])])])]),e("div",he,"總計金額$ "+l(r.deepCloneOrder.total)+" 元",1),t[20]||(t[20]=e("h3",{class:"fs-xl fw-semibold border-bottom mb-3"},"訂購人資訊",-1)),e("div",ve,[t[14]||(t[14]=e("label",{for:"editOrderUserName",class:"form-label"},"訂購人名稱 ",-1)),m(h,{modelValue:r.deepCloneOrder.user.name,"onUpdate:modelValue":t[3]||(t[3]=s=>r.deepCloneOrder.user.name=s),type:"text",rules:"required",name:"OrderUserName",value:r.deepCloneOrder.user.name,label:"訂購人名稱"},{default:x(({field:s,meta:d})=>[e("input",C({id:"editOrderUserName"},s,{class:["form-control",{"is-invalid":p.OrderUserName,"is-valid":d.valid&&d.touched}]}),null,16)]),_:2},1032,["modelValue","value"]),m(v,{name:"OrderUserName",class:"Vee__errMsg"})]),e("div",xe,[t[15]||(t[15]=e("label",{for:"editOrderUserTel",class:"form-label"},"訂購人電話 ",-1)),m(h,{modelValue:r.deepCloneOrder.user.tel,"onUpdate:modelValue":t[4]||(t[4]=s=>r.deepCloneOrder.user.tel=s),modelModifiers:{number:!0},type:"number",rules:"numeric|required",name:"OrderUserTel",value:r.deepCloneOrder.user.tel,label:"訂購人電話"},{default:x(({field:s,meta:d})=>[e("input",C({id:"editOrderUserTel",inputmode:"numeric"},s,{class:["form-control",{"is-invalid":p.OrderUserName,"is-valid":d.valid&&d.touched}]}),null,16)]),_:2},1032,["modelValue","value"]),m(v,{name:"OrderUserTel",class:"Vee__errMsg"})]),e("div",Ce,[t[16]||(t[16]=e("label",{for:"editOrderUserEmail",class:"form-label"},"訂購人信箱 ",-1)),m(h,{modelValue:r.deepCloneOrder.user.email,"onUpdate:modelValue":t[5]||(t[5]=s=>r.deepCloneOrder.user.email=s),type:"email",rules:"email|required",name:"OrderUserEmail",value:r.deepCloneOrder.user.email,label:"訂購人信箱"},{default:x(({field:s,meta:d})=>[e("input",C({id:"editOrderUserEmail"},s,{class:["form-control",{"is-invalid":p.OrderUserName,"is-valid":d.valid&&d.touched}]}),null,16)]),_:2},1032,["modelValue","value"]),m(v,{name:"OrderUserEmail",class:"Vee__errMsg"})]),e("div",we,[t[17]||(t[17]=e("label",{for:"editOrderUserAddress",class:"form-label"},"訂購人地址 ",-1)),m(h,{modelValue:r.deepCloneOrder.user.address,"onUpdate:modelValue":t[6]||(t[6]=s=>r.deepCloneOrder.user.address=s),type:"text",rules:"required",name:"OrderUserAddress",value:r.deepCloneOrder.user.address,label:"訂購人電話"},{default:x(({field:s,meta:d})=>[e("input",C({id:"editOrderUserAddress",inputmode:"numeric"},s,{class:["form-control",{"is-invalid":p.OrderUserName,"is-valid":d.valid&&d.touched}]}),null,16)]),_:2},1032,["modelValue","value"]),m(v,{name:"OrderUserAddress",class:"Vee__errMsg"})]),e("div",Ue,[t[18]||(t[18]=e("h3",{class:"fs-xl fw-semibold"},"訂單備註",-1)),e("p",Ve,l(n.order.message?n.order.message:"無備註內容"),1)])]),e("div",ke,[e("button",{type:"button",class:"btn px-6 py-1 btn-outline-neutral",onClick:t[7]||(t[7]=(...s)=>i.closeModal&&i.closeModal(...s))},"取消"),t[21]||(t[21]=e("button",{type:"submit",class:"btn px-6 py-1 btn-success"},"送出",-1))])]),_:1},8,["onSubmit","initialValues"])])])],512)])}const De=D(B,[["render",Me],["__scopeId","data-v-9bb165e1"]]),Le={data(){return{tempOrder:{},onEdit:!1,currFilter:"全部",OrderSortBy:"最新"}},methods:{...M(k,["getOrders","updateOrder","deleteOrder"]),async getNewOrder(o){await this.getOrders("admin",o)},getModal(o){this.$refs[o].openModal()},editOrder(o){this.tempOrder=o,this.getModal("edit")},getDeleteOrder(o){this.tempOrder=o,this.getModal("delete")},formatDate:$},computed:{...E(k,["orderList","pagination","onLoading"]),finalOrder(){return[...this.orderList].filter(t=>this.currFilter==="全部"?!0:(t.is_paid?"已付款":"未付款")===this.currFilter).sort((t,n)=>this.OrderSortBy==="最新"?t.create_at-n.create_at:n.create_at-t.create_at)}},async mounted(){await this.getOrders("admin")},components:{DeleteModal:F,OrderModal:De,Pagination:S,Loading:A}},Ne={class:"container mx-auto"},Ie={class:"toolbar mb-3"},qe={class:"d-flex flex-wrap align-items-center justify-content-md-between"},Ee={class:"d-flex align-items-center gap-3"},Se={class:"dropdown"},Fe={class:"btn btn-sm btn-outline-neutral dropdown-toggle",type:"button",id:"dropdown__OrderSorter","data-bs-toggle":"dropdown","aria-expanded":"false"},Te={class:"dropdown-menu","aria-labelledby":"dropdown__OrderSorter"},$e=["onClick"],Ae={class:"mb-10"},Be={class:"accordion",id:"adminOrderList"},Pe=["id"],je=["data-bs-target","aria-controls"],Je={class:"badge bg-secondary d-none d-md-inline me-1"},ze={class:"fw-bold fs-lg text-dark"},Qe=["id","aria-labelledby"],Ke={class:"accordion-body"},Re={class:"mb-2"},Xe={class:"mb-2"},Ge={class:"mb-5"},He={class:"mb-5 d-flex flex-wrap gap-4"},We=["src"],Ye={class:"flex-grow-1 me-auto"},Ze={class:"ms-1"},et={class:"ms-2"},tt={class:"text-end fw-semibold fs-lg"},st={class:"fs-base"},rt={class:"mb-5"},dt={class:"mb-3"},ot={class:"mb-3"},lt={class:"mb-3"},nt={class:"mb-3"},it={class:"p-1 text-neutral bg-mute rounded",style:{"min-height":"100px"}},at={class:"accordion-footer px-4 py-2 text-end border-top"},mt=["onClick"],ut=["onClick"];function ct(o,t,n,y,r,i){const h=g("Pagination"),v=g("DeleteModal"),w=g("OrderModal"),p=g("Loading");return a(),u(b,null,[e("div",Ne,[t[13]||(t[13]=e("h2",{class:"fw-bold fs-4xl text-center text-secondary my-10"},"訂單管理",-1)),e("div",Ie,[e("div",qe,[e("div",Ee,[e("button",{type:"button",class:f([r.currFilter==="全部"?"btn-primary":"btn-neutral-light","btn border-0 px-4 py-1"]),onClick:t[0]||(t[0]=s=>r.currFilter="全部")}," 全部 ",2),e("button",{type:"button",class:f([r.currFilter==="已付款"?"btn-primary":"btn-neutral-light","btn border-0 px-4 py-1"]),onClick:t[1]||(t[1]=s=>r.currFilter="已付款")}," 已付款 ",2),e("button",{type:"button",class:f([r.currFilter==="未付款"?"btn-primary":"btn-neutral-light","btn border-0 px-4 py-1"]),onClick:t[2]||(t[2]=s=>r.currFilter="未付款")}," 未付款 ",2)]),e("div",Se,[e("button",Fe,l(r.OrderSortBy),1),e("ul",Te,[(a(),u(b,null,O(["最新","最舊"],s=>e("li",{class:"dropdown-item cursor-pointer",key:s,onClick:d=>r.OrderSortBy=s},l(s),9,$e)),64))])])])]),e("div",Ae,[e("div",Be,[(a(!0),u(b,null,O(i.finalOrder,(s,d)=>(a(),u("div",{key:s.id,class:"accordion-item rounded-bottom rounded-2 overflow-hidden mb-3"},[e("h2",{class:"accordion-header",id:`order${d}`},[e("button",{class:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":`#orderItem${d+1}`,"aria-expanded":"false","aria-controls":`orderItem${d+1}`,style:{"background-color":"var(--bs-primary)","box-shadow":"none"}},[e("div",Je,l(i.formatDate(s.create_at)),1),e("span",{class:f(["badge me-3",s.is_paid?"bg-success":"bg-neutral"])},l(s.is_paid?"已付款":"未付款"),3),e("span",ze,l(`訂單${s.id}`),1)],8,je)],8,Pe),e("div",{id:`orderItem${d+1}`,class:"accordion-collapse collapse","aria-labelledby":`order${d}`,"data-bs-parent":"#adminOrderList"},[e("div",Ke,[e("div",Re,[e("span",null,"訂單編號: "+l(s.id),1)]),e("div",Xe,[e("span",null,"詳細日期: "+l(i.formatDate(s.create_at,!0)),1)]),e("div",Ge,[t[4]||(t[4]=e("span",null," 付款狀態: ",-1)),e("span",{class:f(["badge me-3 align-middle",s.is_paid?"bg-success":"bg-neutral"])},l(s.is_paid?"已付款":"未付款"),3)]),t[10]||(t[10]=e("h3",{class:"mb-3 fs-xl border-bottom"},"訂單資訊",-1)),e("div",He,[(a(!0),u(b,null,O(s.products,c=>(a(),u("div",{key:c.id,class:"p-1 bg-primary d-flex align-items-center mb-3",style:{"max-width":"320px"}},[e("img",{src:c.product.imageUrl,alt:"",style:{width:"40px","aspect-ratio":"1"},class:"me-2"},null,8,We),e("p",Ye,[_(l(c.product.title)+" ",1),e("span",Ze,l(c.qty)+"("+l(c.product.unit)+")",1)]),e("p",et,"共"+l(c.final_total)+"元",1)]))),128))]),e("p",tt,[t[5]||(t[5]=_(" 總計: ",-1)),e("span",st,l(s.total),1)]),t[11]||(t[11]=e("h3",{class:"mb-3 fs-xl border-bottom"},"訂購人資訊",-1)),e("ul",rt,[e("li",dt,[t[6]||(t[6]=e("span",{class:"me-2"},"訂購人名稱:",-1)),_(l(s.user.name),1)]),e("li",ot,[t[7]||(t[7]=e("span",{class:"me-2"},"訂購人電話:",-1)),_(l(s.user.tel),1)]),e("li",lt,[t[8]||(t[8]=e("span",{class:"me-2"},"訂購人信箱:",-1)),_(l(s.user.email),1)]),e("li",nt,[t[9]||(t[9]=e("span",{class:"me-2"},"訂購人地址:",-1)),_(l(s.user.address),1)])]),t[12]||(t[12]=e("h3",{class:"mb-3 fs-xl border-bottom"},"訂單備註",-1)),e("p",it,l(s.message?s.message:"無備註內容"),1)]),e("div",at,[e("button",{type:"button",class:"btn px-6 py-1 bg-danger text-white me-4 bg-hover-danger",onClick:c=>i.getDeleteOrder(s)}," 刪除 ",8,mt),e("button",{type:"button",class:"btn px-6 py-1 bg-primary bg-hover-accent",onClick:c=>i.editOrder(s)}," 編輯 ",8,ut)])],8,Qe)]))),128))])]),m(h,{pagination:o.pagination,onUpdatePage:i.getNewOrder},null,8,["pagination","onUpdatePage"])]),m(v,{ref:"delete",title:r.tempOrder.id,"target-id":r.tempOrder.id,onDeleteTarget:t[3]||(t[3]=async s=>await o.deleteOrder(s))},null,8,["title","target-id"]),m(w,{ref:"edit",order:r.tempOrder,formatDate:i.formatDate,onUpdateOrder:o.updateOrder},null,8,["order","formatDate","onUpdateOrder"]),m(p,{active:o.onLoading},null,8,["active"])],64)}const ht=D(Le,[["render",ct],["__scopeId","data-v-9e6a05e2"]]);export{ht as default};
